# MCP Playwright Test Runner - Complete Setup âœ…

## What's Been Implemented

### âœ… MCP Server (on port 3000)
- **Express API** with CORS enabled
- **POST /api/run-tests** - Execute Playwright tests
- **GET /report** - Serve HTML test report
- **GET /** - API documentation
- **Headless/Headed modes** - Control browser visibility
- **Browser selection** - Run specific browsers (chromium, webkit, firefox)
- **Environment variables** - Pass credentials to tests
- **HTML Reports** - Auto-generated by Playwright

### âœ… Test Runners (Auto-Report Opening)
1. **Node.js Runner** (`run-tests.cjs`) - Cross-platform, auto-opens report
2. **Shell Script** (`run-tests.sh`) - macOS/Linux, auto-opens report
3. **npm scripts** - Convenient shortcuts in package.json
4. **Raw curl** - Direct API access with manual report opening

### âœ… Features
- âœ… Tests execute via MCP API
- âœ… Report auto-opens in new browser tab
- âœ… Chromium-only or all browsers
- âœ… Headless (fast) or headed (debug) modes
- âœ… Real-time test output streaming
- âœ… Exit code properly returned (0=pass, 1=fail)
- âœ… Environment variables support
- âœ… Cross-platform support (macOS, Linux, Windows)

---

## Quick Commands

### 1. Start Server (1st Terminal)
```bash
cd mcp-server
npm start
# âœ… Server running on http://localhost:3000
```

### 2. Run Tests with Auto-Report (2nd Terminal)

#### Easiest (recommended)
```bash
cd /Users/rushikeshpatil/Desktop/v2

# Chromium + Headed Mode + Auto-Report
npm run test:chromium:headed

# Chromium + Headless Mode + Auto-Report
npm run test:chromium

# All Browsers + Headed Mode + Auto-Report
npm run test:headed

# All Browsers + Headless Mode + Auto-Report
npm run test:mcp
```

#### Direct Node.js
```bash
# Format: node run-tests.cjs [test-file] [browser] [headless]
node run-tests.cjs tests/demoblaze-smoke.spec.js chromium false
```

#### Direct Shell Script (macOS/Linux)
```bash
./run-tests.sh tests/demoblaze-smoke.spec.js chromium false
```

#### Raw curl (Manual Report Opening)
```bash
curl -X POST http://localhost:3000/api/run-tests \
  -H "Content-Type: application/json" \
  -d '{"test":"tests/demoblaze-smoke.spec.js","browser":"chromium","headless":false}'
# Response includes report URL: http://localhost:3000/report
```

---

## Expected Output

### Terminal Output
```
ğŸš€ Running Playwright tests via MCP Server...
   ğŸ“ Test: tests/demoblaze-smoke.spec.js
   ğŸŒ Browser: chromium
   ğŸ‘ï¸  Headless: no

Running 2 tests using 1 worker

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… ALL TESTS PASSED!
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Š Test Report Generated!
   URL: http://localhost:3000/report
   Message: ğŸ“Š Report ready! Open: http://localhost:3000/report

ğŸŒ Opening report in browser...
```

### Browser Opens Automatically
- Report URL: `http://localhost:3000/report`
- Shows interactive Playwright HTML report
- Lists all tests, results, traces, screenshots

---

## Current Test Status

### âœ… DemoBlaze Smoke Tests (Passing)
```
âœ“ DemoBlaze - Basic page load
âœ“ DemoBlaze - Simple navigation
2 passed (9.1s)
```

### Files
- Test File: `tests/demoblaze-smoke.spec.js`
- API Server: `mcp-server/server.js`
- Runner: `run-tests.cjs`
- Config: `playwright.config.js`

---

## API Reference

### POST /api/run-tests
```bash
# Request
{
  "test": "tests/demoblaze-smoke.spec.js",
  "browser": "chromium",        // optional
  "headless": false,            // optional
  "env": {                      // optional
    "AMAZON_EMAIL": "test@example.com"
  }
}

# Response
{
  "code": 0,                    // exit code
  "stdout": "test output...",
  "stderr": "",
  "report": {
    "url": "http://localhost:3000/report",
    "message": "ğŸ“Š Report ready! Open: http://localhost:3000/report"
  }
}
```

### GET /report
- Opens: `/playwright-report/index.html`
- Shows: Interactive test results, traces, videos

### GET /
- Returns: API documentation and examples

---

## File Structure

```
/Users/rushikeshpatil/Desktop/v2/
â”œâ”€â”€ mcp-server/
â”‚   â”œâ”€â”€ server.js              â† Express API server
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ node_modules/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ demoblaze-smoke.spec.js    âœ… PASSING
â”‚   â”œâ”€â”€ amazon-login.spec.js
â”‚   â””â”€â”€ ...
â”œâ”€â”€ playwright-report/         â† HTML reports generated here
â”œâ”€â”€ run-tests.cjs              â† Node.js runner (auto-report)
â”œâ”€â”€ run-tests.sh               â† Shell script runner (auto-report)
â”œâ”€â”€ package.json               â† npm scripts configured
â”œâ”€â”€ TEST_RUNNER_README.md      â† Detailed documentation
â”œâ”€â”€ playwright.config.js
â””â”€â”€ README.md
```

---

## Troubleshooting

### Report not opening automatically?
- Manual URL: `http://localhost:3000/report`
- Check browser permissions
- Verify browser is installed

### Tests timing out?
- Use headless mode (faster): `headless: true`
- Increase timeout in `playwright.config.js`
- Check internet connection

### Server not responding?
```bash
curl http://localhost:3000/
# Should return: {"status":"mcp-server ready âœ…",...}
```

---

## Summary

âœ… **Complete MCP Playwright integration ready!**

### Key URLs
- MCP API: `http://localhost:3000`
- Reports: `http://localhost:3000/report`
- Examples: `http://localhost:3000/`

### Key Commands
- Start: `cd mcp-server && npm start`
- Test: `npm run test:chromium:headed`
- Run: `node run-tests.cjs [test] [browser] [headless]`

**Report automatically opens in browser after tests complete! ğŸ‰**
